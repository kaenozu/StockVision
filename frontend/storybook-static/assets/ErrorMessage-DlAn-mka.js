import{r as u}from"./index-0yr9KlQE.js";import{S as D,s as w,V as S}from"./stockApi-CSKHuUhm.js";import{j as o}from"./jsx-runtime-D_zvdyIk.js";const W={locale:"ja-JP",currency:"JPY",minimumFractionDigits:0,maximumFractionDigits:2};function J(e,t={}){const r={...W,...t};try{return new Intl.NumberFormat(r.locale,{style:"currency",currency:r.currency,minimumFractionDigits:r.minimumFractionDigits,maximumFractionDigits:r.maximumFractionDigits}).format(e)}catch(s){return console.warn("Price formatting error:",s),`¥${e.toFixed(r.maximumFractionDigits)}`}}function A(e,t=2){try{return new Intl.NumberFormat("ja-JP",{minimumFractionDigits:0,maximumFractionDigits:t}).format(e)}catch(r){return console.warn("Price value formatting error:",r),e.toFixed(t)}}function H(e,t=!0){const r=A(Math.abs(e)),s=e>0?"positive":e<0?"negative":"neutral";let a=r;return t&&(e>0?a=`+${r}`:e<0&&(a=`-${r}`)),{formatted:a,colorClass:s==="positive"?"price-positive":s==="negative"?"price-negative":"text-gray-600",sign:s}}function G(e,t=!0){const r=Math.round(e*100)/100,s=r>0?"positive":r<0?"negative":"neutral";let a=Math.abs(r).toFixed(2)+"%";return t&&(r>0?a=`+${Math.abs(r).toFixed(2)}%`:r<0&&(a=`-${Math.abs(r).toFixed(2)}%`)),{formatted:a,colorClass:s==="positive"?"price-positive":s==="negative"?"price-negative":"text-gray-600",sign:s}}function X(e){try{const t=new Date(e);return isNaN(t.getTime())?e:new Intl.DateTimeFormat("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).format(t)}catch(t){return console.warn("Timestamp formatting error:",t),e}}function Y(e){switch(e){case"open":return{text:"取引中",colorClass:"text-green-600",icon:"🟢"};case"closed":return{text:"取引終了",colorClass:"text-red-600",icon:"🔴"};case"pre_market":return{text:"取引前",colorClass:"text-yellow-600",icon:"🟡"};case"after_hours":return{text:"時間外",colorClass:"text-blue-600",icon:"🔵"};default:return{text:"不明",colorClass:"text-gray-600",icon:"⚫"}}}function Q(e){return!e||typeof e!="string"?"":e.replace(/[^0-9]/g,"").padStart(4,"0")}function Z(e){if(e instanceof Error){const t=e.message.toLowerCase();return t.includes("network")||t.includes("fetch")?"ネットワークエラーが発生しました。接続を確認してください。":t.includes("timeout")?"リクエストがタイムアウトしました。しばらく後で再試行してください。":t.includes("not found")||t.includes("404")?"指定された銘柄コードが見つかりませんでした。":t.includes("invalid")||t.includes("validation")?"入力データに問題があります。内容を確認してください。":e.message}else return typeof e=="string"?e:"予期しないエラーが発生しました。"}function F(e){if(!e||typeof e!="string")return{is_valid:!1,error_message:"銘柄コードを入力してください"};const t=e.trim();return t.length===0?{is_valid:!1,error_message:"銘柄コードを入力してください"}:D.test(t)?{is_valid:!0,normalized_code:t}:{is_valid:!1,error_message:"銘柄コードは4桁の数字で入力してください（例: 7203）"}}function R(e){const t=[],r=[];if(e==null||e==="")return{is_valid:!0,errors:t,warnings:r};const s=typeof e=="string"?parseFloat(e):e;return isNaN(s)?(t.push("価格は数値で入力してください"),{is_valid:!1,errors:t,warnings:r}):(s<=0&&t.push("価格は0より大きい値を入力してください"),s>1e6&&r.push("価格が非常に高く設定されています"),{is_valid:t.length===0,errors:t,warnings:r})}function ee(e){const t=[],r=[],s=F(e.stock_code);return s.is_valid||t.push(s.error_message||"無効な銘柄コード"),typeof e.use_real_data!="boolean"&&t.push("リアルデータフラグは真偽値で指定してください"),e.use_real_data&&r.push("リアルデータを使用すると応答が遅くなる場合があります"),{is_valid:t.length===0,errors:t,warnings:r}}function q(e){const t=[],r=[],s=F(e.stock_code);if(s.is_valid||t.push(s.error_message||"無効な銘柄コード"),e.alert_price_high!==null&&e.alert_price_high!==void 0){const a=R(e.alert_price_high);a.is_valid||t.push(...a.errors),r.push(...a.warnings)}if(e.alert_price_low!==null&&e.alert_price_low!==void 0){const a=R(e.alert_price_low);a.is_valid||t.push(...a.errors),r.push(...a.warnings)}return e.notes!==null&&e.notes!==void 0&&(typeof e.notes!="string"?t.push("メモは文字列で入力してください"):e.notes.length>500&&t.push("メモは500文字以内で入力してください")),{is_valid:t.length===0,errors:t,warnings:r}}function te(e){return!e||typeof e!="string"?"":e.trim().replace(/[^0-9]/g,"").substring(0,4)}const x={400:"入力内容に問題があります。内容を確認してください。",401:"認証に失敗しました。再度ログインしてください。",403:"アクセスが許可されていません。",404:"リクエストされたデータが見つかりません。",409:"リクエストが競合しています。再度お試しください。",422:"入力内容の形式に問題があります。",429:"リクエストが多すぎます。しばらくしてから再度お試しください。",500:"サーバー内部でエラーが発生しました。しばらくしてから再度お試しください。",502:"ゲートウェイエラーが発生しました。しばらくしてから再度お試しください。",503:"サービスが一時的に利用できません。しばらくしてから再度お試しください。",504:"ゲートウェイタイムアウトが発生しました。しばらくしてから再度お試しください。",STOCK_NOT_FOUND:"指定された銘柄が見つかりません。",INVALID_STOCK_CODE:"銘柄コードの形式が正しくありません。",DUPLICATE_WATCHLIST_ITEM:"この銘柄は既にウォッチリストに登録されています。",WATCHLIST_ITEM_NOT_FOUND:"ウォッチリストの項目が見つかりません。",EXTERNAL_API_ERROR:"外部サービスでエラーが発生しました。しばらくしてから再度お試しください。",DATABASE_CONNECTION_ERROR:"データベース接続に失敗しました。しばらくしてから再度お試しください。",NETWORK_ERROR:"ネットワーク接続に問題があります。インターネット接続を確認してください。",TIMEOUT_ERROR:"リクエストがタイムアウトしました。しばらくしてから再度お試しください。",CONNECTION_ERROR:"サーバーへの接続に失敗しました。しばらくしてから再度お試しください。"};function $(e){if(e?.response?.status){const t=e.response.status.toString();if(x[t])return x[t]}if(e?.code&&x[e.code])return x[e.code];if(e?.message){const t=e.message.toLowerCase();if(t.includes("network"))return x.NETWORK_ERROR;if(t.includes("timeout"))return x.TIMEOUT_ERROR;if(t.includes("connection"))return x.CONNECTION_ERROR}return"エラーが発生しました。しばらくしてから再度お試しください。"}function L(e=!0){const[t,r]=u.useState({data:null,status:"idle",error:null}),[s,a]=u.useState(new Map),l=u.useCallback(async()=>{r(n=>({...n,status:"loading",error:null}));try{const i=(await w.getWatchlist()).map(c=>({...c,id:`watchlist-${c.stock_code}`,isLoading:!1,hasError:!1}));r({data:i,status:"success",error:null})}catch(n){console.error("Failed to fetch watchlist:",n),r({data:null,status:"error",error:$(n)})}},[]);u.useEffect(()=>{e&&l()},[e,l]);const h=u.useCallback(async n=>{const i=q(n);if(!i.is_valid)throw new S(`Invalid watchlist request: ${i.errors.join(", ")}`);const c=n.stock_code;a(d=>new Map(d).set(c,{isAdding:!0,isRemoving:!1,hasError:!1}));try{const d=await w.addToWatchlist(n),f={...d,id:`watchlist-${d.stock_code}`,isLoading:!1,hasError:!1};return r(E=>{const y=E.data||[],I=y.findIndex(b=>b.stock_code===c);if(I>=0){const b=[...y];return b[I]=f,{...E,data:b}}else return{...E,data:[...y,f]}}),a(E=>{const y=new Map(E);return y.delete(c),y}),!0}catch(d){throw console.error("Failed to add to watchlist:",d),a(f=>new Map(f).set(c,{isAdding:!1,isRemoving:!1,hasError:!0})),d}},[]),v=u.useCallback(async n=>{if(!n)throw new S("Stock code is required for removal");a(i=>new Map(i).set(n,{isAdding:!1,isRemoving:!0,hasError:!1}));try{return await w.removeFromWatchlist(n),r(i=>{const d=(i.data||[]).filter(f=>f.stock_code!==n);return{...i,data:d}}),a(i=>{const c=new Map(i);return c.delete(n),c}),!0}catch(i){throw console.error("Failed to remove from watchlist:",i),a(c=>new Map(c).set(n,{isAdding:!1,isRemoving:!1,hasError:!0})),i}},[]),_=u.useCallback(n=>t.data?t.data.some(i=>i.stock_code===n):!1,[t.data]),p=u.useCallback(n=>t.data&&t.data.find(i=>i.stock_code===n)||null,[t.data]),m=u.useCallback(n=>s.get(n)||{isAdding:!1,isRemoving:!1,hasError:!1},[s]),g=u.useCallback(n=>{a(i=>{const c=new Map(i),d=c.get(n);return d&&c.set(n,{...d,hasError:!1}),c})},[]),O=u.useCallback(()=>{const n=t.data||[],i=n.length,c=n.filter(f=>f.alert_price!==null).length,d=n.filter(f=>f.notes&&f.notes.trim().length>0).length;return{totalItems:i,itemsWithAlerts:c,itemsWithNotes:d}},[t.data]),j=u.useCallback(()=>{l()},[l]);return{...t,items:t.data||[],fetch:l,refresh:j,addToWatchlist:h,removeFromWatchlist:v,isInWatchlist:_,getWatchlistItem:p,getItemState:m,clearItemError:g,getWatchlistStats:O,isLoading:t.status==="loading",isError:t.status==="error",isSuccess:t.status==="success",isEmpty:t.data?.length===0}}function re(e){const t=L(),r=t.getWatchlistItem(e),s=t.getItemState(e),a=t.isInWatchlist(e),l=u.useCallback(async(_,p,m)=>{const g={stock_code:e,alert_price_high:_||null,alert_price_low:p||null,notes:m||null};return t.addToWatchlist(g)},[e,t]),h=u.useCallback(async()=>t.removeFromWatchlist(e),[e,t]),v=u.useCallback(async(_,p,m)=>a?h():l(_,p,m),[a,l,h]);return{item:r,isInWatchlist:a,isAdding:s.isAdding,isRemoving:s.isRemoving,hasError:s.hasError,addToWatchlist:l,removeFromWatchlist:h,toggleWatchlist:v,clearError:()=>t.clearItemError(e)}}const P={error:{bgColor:"bg-red-50",borderColor:"border-red-200",textColor:"text-red-800",iconColor:"text-red-400",buttonColor:"bg-red-600 hover:bg-red-700",icon:"❌"},warning:{bgColor:"bg-yellow-50",borderColor:"border-yellow-200",textColor:"text-yellow-800",iconColor:"text-yellow-400",buttonColor:"bg-yellow-600 hover:bg-yellow-700",icon:"⚠️"},info:{bgColor:"bg-blue-50",borderColor:"border-blue-200",textColor:"text-blue-800",iconColor:"text-blue-400",buttonColor:"bg-blue-600 hover:bg-blue-700",icon:"ℹ️"}},z={sm:{padding:"p-3",textSize:"text-sm",buttonSize:"px-3 py-1 text-sm"},md:{padding:"p-4",textSize:"text-base",buttonSize:"px-4 py-2 text-sm"},lg:{padding:"p-6",textSize:"text-lg",buttonSize:"px-6 py-3 text-base"}};function N(e){return e?typeof e=="string"?e:e instanceof Error?e.message:"不明なエラーが発生しました":""}function C({error:e,type:t="error",size:r="md",showIcon:s=!0,onRetry:a,onDismiss:l,retryText:h="再試行",dismissText:v="閉じる",className:_=""}){const p=N(e);if(!p)return null;const m=P[t],g=z[r];return o.jsx("div",{className:`
      ${m.bgColor} 
      ${m.borderColor} 
      ${m.textColor}
      border rounded-lg
      ${g.padding}
      ${_}
    `,children:o.jsxs("div",{className:"flex items-start space-x-3",children:[s&&o.jsx("span",{className:`${g.textSize} flex-shrink-0`,role:"img","aria-label":t,children:m.icon}),o.jsx("div",{className:"flex-1 min-w-0",children:o.jsx("p",{className:`${g.textSize} font-medium`,children:p})}),(a||l)&&o.jsxs("div",{className:"flex-shrink-0 flex space-x-2",children:[a&&o.jsx("button",{onClick:a,className:`
                  ${m.buttonColor}
                  ${g.buttonSize}
                  text-white
                  rounded
                  font-medium
                  transition-colors
                  focus:outline-none
                  focus:ring-2
                  focus:ring-offset-2
                  focus:ring-opacity-50
                `,children:h}),l&&o.jsx("button",{onClick:l,className:`
                  ${g.buttonSize}
                  ${m.textColor}
                  border
                  ${m.borderColor}
                  rounded
                  font-medium
                  transition-colors
                  hover:bg-opacity-50
                  focus:outline-none
                  focus:ring-2
                  focus:ring-offset-2
                  focus:ring-opacity-50
                `,children:v})]})]})})}function T({error:e,className:t=""}){const r=N(e);return r?o.jsx("p",{className:`text-red-600 text-sm font-medium ${t}`,children:r}):null}function M({error:e,onRetry:t,className:r=""}){const s=N(e);if(!s)return null;const l=s.toLowerCase().includes("network")||s.toLowerCase().includes("fetch")||s.toLowerCase().includes("timeout")?"ネットワーク接続に問題があります。インターネット接続を確認してください。":s;return o.jsx(C,{error:l,type:"error",showIcon:!0,onRetry:t,retryText:"再接続",className:r})}function k({errors:e,className:t=""}){return!e||e.length===0?null:o.jsx("div",{className:`bg-red-50 border border-red-200 rounded-lg p-4 ${t}`,children:o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx("span",{className:"text-red-400 flex-shrink-0",role:"img","aria-label":"エラー",children:"❌"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:"text-red-800 font-medium text-sm mb-2",children:"入力内容に問題があります:"}),o.jsx("ul",{className:"text-red-700 text-sm space-y-1 list-disc list-inside",children:e.map((r,s)=>o.jsx("li",{children:r},s))})]})]})})}function V({title:e="データがありません",description:t="",icon:r="📭",action:s,actionText:a="データを取得",className:l=""}){return o.jsxs("div",{className:`text-center py-12 ${l}`,children:[o.jsx("div",{className:"text-6xl mb-4",role:"img","aria-label":"空の状態",children:r}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:e}),t&&o.jsx("p",{className:"text-gray-600 mb-6",children:t}),s&&o.jsx("button",{onClick:s,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:a})]})}try{C.displayName="ErrorMessage",C.__docgenInfo={description:"",displayName:"ErrorMessage",props:{error:{defaultValue:null,description:"",name:"error",required:!0,type:{name:"enum",value:[{value:"string"},{value:"Error"}]}},type:{defaultValue:{value:"error"},description:"",name:"type",required:!1,type:{name:"enum",value:[{value:'"error"'},{value:'"warning"'},{value:'"info"'}]}},size:{defaultValue:{value:"md"},description:"",name:"size",required:!1,type:{name:"enum",value:[{value:'"sm"'},{value:'"md"'},{value:'"lg"'}]}},showIcon:{defaultValue:{value:"true"},description:"",name:"showIcon",required:!1,type:{name:"enum",value:[{value:"false"},{value:"true"}]}},onRetry:{defaultValue:null,description:"",name:"onRetry",required:!1,type:{name:"() => void"}},onDismiss:{defaultValue:null,description:"",name:"onDismiss",required:!1,type:{name:"() => void"}},retryText:{defaultValue:{value:"再試行"},description:"",name:"retryText",required:!1,type:{name:"string"}},dismissText:{defaultValue:{value:"閉じる"},description:"",name:"dismissText",required:!1,type:{name:"string"}},className:{defaultValue:{value:""},description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}try{T.displayName="InlineErrorMessage",T.__docgenInfo={description:"Inline Error Message (for forms, etc.)",displayName:"InlineErrorMessage",props:{error:{defaultValue:null,description:"",name:"error",required:!0,type:{name:"enum",value:[{value:"string"},{value:"Error"}]}},className:{defaultValue:{value:""},description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}try{M.displayName="NetworkErrorMessage",M.__docgenInfo={description:"Network Error Message (specialized for API errors)",displayName:"NetworkErrorMessage",props:{error:{defaultValue:null,description:"",name:"error",required:!0,type:{name:"enum",value:[{value:"string"},{value:"Error"}]}},onRetry:{defaultValue:null,description:"",name:"onRetry",required:!1,type:{name:"() => void"}},className:{defaultValue:{value:""},description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}try{k.displayName="ValidationErrorList",k.__docgenInfo={description:"Validation Error List",displayName:"ValidationErrorList",props:{errors:{defaultValue:null,description:"",name:"errors",required:!0,type:{name:"string[]"}},className:{defaultValue:{value:""},description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}try{V.displayName="EmptyStateMessage",V.__docgenInfo={description:"Empty State Message",displayName:"EmptyStateMessage",props:{title:{defaultValue:{value:"データがありません"},description:"",name:"title",required:!1,type:{name:"string"}},description:{defaultValue:{value:""},description:"",name:"description",required:!1,type:{name:"string"}},icon:{defaultValue:{value:"📭"},description:"",name:"icon",required:!1,type:{name:"string"}},action:{defaultValue:null,description:"",name:"action",required:!1,type:{name:"() => void"}},actionText:{defaultValue:{value:"データを取得"},description:"",name:"actionText",required:!1,type:{name:"string"}},className:{defaultValue:{value:""},description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}export{C as E,T as I,G as a,Y as b,J as c,Z as d,Q as e,H as f,$ as g,L as h,V as i,X as j,te as s,re as u,ee as v};
