import{r as c}from"./index-0yr9KlQE.js";import{S as O,s as E,V as T}from"./stockApi-Cf11MmaB.js";import{j as d}from"./jsx-runtime-D_zvdyIk.js";const k={locale:"ja-JP",currency:"JPY",minimumFractionDigits:0,maximumFractionDigits:2};function K(e,t={}){const r={...k,...t};try{return new Intl.NumberFormat(r.locale,{style:"currency",currency:r.currency,minimumFractionDigits:r.minimumFractionDigits,maximumFractionDigits:r.maximumFractionDigits}).format(e)}catch(n){return console.warn("Price formatting error:",n),`¥${e.toFixed(r.maximumFractionDigits)}`}}function F(e,t=2){try{return new Intl.NumberFormat("ja-JP",{minimumFractionDigits:0,maximumFractionDigits:t}).format(e)}catch(r){return console.warn("Price value formatting error:",r),e.toFixed(t)}}function J(e,t=!0){const r=F(Math.abs(e)),n=e>0?"positive":e<0?"negative":"neutral";let s=r;return t&&(e>0?s=`+${r}`:e<0&&(s=`-${r}`)),{formatted:s,colorClass:n==="positive"?"price-positive":n==="negative"?"price-negative":"text-gray-600",sign:n}}function H(e,t=!0){const r=Math.round(e*100)/100,n=r>0?"positive":r<0?"negative":"neutral";let s=Math.abs(r).toFixed(2)+"%";return t&&(r>0?s=`+${Math.abs(r).toFixed(2)}%`:r<0&&(s=`-${Math.abs(r).toFixed(2)}%`)),{formatted:s,colorClass:n==="positive"?"price-positive":n==="negative"?"price-negative":"text-gray-600",sign:n}}function B(e){try{const t=new Date(e);return isNaN(t.getTime())?e:new Intl.DateTimeFormat("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).format(t)}catch(t){return console.warn("Timestamp formatting error:",t),e}}function G(e){switch(e){case"open":return{text:"取引中",colorClass:"text-green-600",icon:"🟢"};case"closed":return{text:"取引終了",colorClass:"text-red-600",icon:"🔴"};case"pre_market":return{text:"取引前",colorClass:"text-yellow-600",icon:"🟡"};case"after_hours":return{text:"時間外",colorClass:"text-blue-600",icon:"🔵"};default:return{text:"不明",colorClass:"text-gray-600",icon:"⚫"}}}function X(e){return!e||typeof e!="string"?"":e.replace(/[^0-9]/g,"").padStart(4,"0")}function Y(e){if(e instanceof Error){const t=e.message.toLowerCase();return t.includes("network")||t.includes("fetch")?"ネットワークエラーが発生しました。接続を確認してください。":t.includes("timeout")?"リクエストがタイムアウトしました。しばらく後で再試行してください。":t.includes("not found")||t.includes("404")?"指定された銘柄コードが見つかりませんでした。":t.includes("invalid")||t.includes("validation")?"入力データに問題があります。内容を確認してください。":e.message}else return typeof e=="string"?e:"予期しないエラーが発生しました。"}function N(e){if(!e||typeof e!="string")return{is_valid:!1,error_message:"銘柄コードを入力してください"};const t=e.trim();return t.length===0?{is_valid:!1,error_message:"銘柄コードを入力してください"}:O.test(t)?{is_valid:!0,normalized_code:t}:{is_valid:!1,error_message:"銘柄コードは4桁の数字で入力してください（例: 7203）"}}function I(e){const t=[],r=[];if(e==null||e==="")return{is_valid:!0,errors:t,warnings:r};const n=typeof e=="string"?parseFloat(e):e;return isNaN(n)?(t.push("価格は数値で入力してください"),{is_valid:!1,errors:t,warnings:r}):(n<=0&&t.push("価格は0より大きい値を入力してください"),n>1e6&&r.push("価格が非常に高く設定されています"),{is_valid:t.length===0,errors:t,warnings:r})}function Q(e){const t=[],r=[],n=N(e.stock_code);return n.is_valid||t.push(n.error_message||"無効な銘柄コード"),typeof e.use_real_data!="boolean"&&t.push("リアルデータフラグは真偽値で指定してください"),e.use_real_data&&r.push("リアルデータを使用すると応答が遅くなる場合があります"),{is_valid:t.length===0,errors:t,warnings:r}}function W(e){const t=[],r=[],n=N(e.stock_code);if(n.is_valid||t.push(n.error_message||"無効な銘柄コード"),e.alert_price_high!==null&&e.alert_price_high!==void 0){const s=I(e.alert_price_high);s.is_valid||t.push(...s.errors),r.push(...s.warnings)}if(e.alert_price_low!==null&&e.alert_price_low!==void 0){const s=I(e.alert_price_low);s.is_valid||t.push(...s.errors),r.push(...s.warnings)}return e.notes!==null&&e.notes!==void 0&&(typeof e.notes!="string"?t.push("メモは文字列で入力してください"):e.notes.length>500&&t.push("メモは500文字以内で入力してください")),{is_valid:t.length===0,errors:t,warnings:r}}function Z(e){return!e||typeof e!="string"?"":e.trim().replace(/[^0-9]/g,"").substring(0,4)}const x={400:"入力内容に問題があります。内容を確認してください。",401:"認証に失敗しました。再度ログインしてください。",403:"アクセスが許可されていません。",404:"リクエストされたデータが見つかりません。",409:"リクエストが競合しています。再度お試しください。",422:"入力内容の形式に問題があります。",429:"リクエストが多すぎます。しばらくしてから再度お試しください。",500:"サーバー内部でエラーが発生しました。しばらくしてから再度お試しください。",502:"ゲートウェイエラーが発生しました。しばらくしてから再度お試しください。",503:"サービスが一時的に利用できません。しばらくしてから再度お試しください。",504:"ゲートウェイタイムアウトが発生しました。しばらくしてから再度お試しください。",STOCK_NOT_FOUND:"指定された銘柄が見つかりません。",INVALID_STOCK_CODE:"銘柄コードの形式が正しくありません。",DUPLICATE_WATCHLIST_ITEM:"この銘柄は既にウォッチリストに登録されています。",WATCHLIST_ITEM_NOT_FOUND:"ウォッチリストの項目が見つかりません。",EXTERNAL_API_ERROR:"外部サービスでエラーが発生しました。しばらくしてから再度お試しください。",DATABASE_CONNECTION_ERROR:"データベース接続に失敗しました。しばらくしてから再度お試しください。",NETWORK_ERROR:"ネットワーク接続に問題があります。インターネット接続を確認してください。",TIMEOUT_ERROR:"リクエストがタイムアウトしました。しばらくしてから再度お試しください。",CONNECTION_ERROR:"サーバーへの接続に失敗しました。しばらくしてから再度お試しください。"};function $(e){if(e?.response?.status){const t=e.response.status.toString();if(x[t])return x[t]}if(e?.code&&x[e.code])return x[e.code];if(e?.message){const t=e.message.toLowerCase();if(t.includes("network"))return x.NETWORK_ERROR;if(t.includes("timeout"))return x.TIMEOUT_ERROR;if(t.includes("connection"))return x.CONNECTION_ERROR}return"エラーが発生しました。しばらくしてから再度お試しください。"}function A(e=!0){const[t,r]=c.useState({data:null,status:"idle",error:null}),[n,s]=c.useState(new Map),l=c.useCallback(async()=>{r(a=>({...a,status:"loading",error:null}));try{const i=(await E.getWatchlist()).map(o=>({...o,id:`watchlist-${o.stock_code}`,isLoading:!1,hasError:!1}));r({data:i,status:"success",error:null})}catch(a){console.error("Failed to fetch watchlist:",a),r({data:null,status:"error",error:$(a)})}},[]);c.useEffect(()=>{e&&l()},[e,l]);const h=c.useCallback(async a=>{const i=W(a);if(!i.is_valid)throw new T(`Invalid watchlist request: ${i.errors.join(", ")}`);const o=a.stock_code;s(u=>new Map(u).set(o,{isAdding:!0,isRemoving:!1,hasError:!1}));try{const u=await E.addToWatchlist(a),f={...u,id:`watchlist-${u.stock_code}`,isLoading:!1,hasError:!1};return r(b=>{const _=b.data||[],C=_.findIndex(w=>w.stock_code===o);if(C>=0){const w=[..._];return w[C]=f,{...b,data:w}}else return{...b,data:[..._,f]}}),s(b=>{const _=new Map(b);return _.delete(o),_}),!0}catch(u){throw console.error("Failed to add to watchlist:",u),s(f=>new Map(f).set(o,{isAdding:!1,isRemoving:!1,hasError:!0})),u}},[]),y=c.useCallback(async a=>{if(!a)throw new T("Stock code is required for removal");s(i=>new Map(i).set(a,{isAdding:!1,isRemoving:!0,hasError:!1}));try{return await E.removeFromWatchlist(a),r(i=>{const u=(i.data||[]).filter(f=>f.stock_code!==a);return{...i,data:u}}),s(i=>{const o=new Map(i);return o.delete(a),o}),!0}catch(i){throw console.error("Failed to remove from watchlist:",i),s(o=>new Map(o).set(a,{isAdding:!1,isRemoving:!1,hasError:!0})),i}},[]),v=c.useCallback(a=>t.data?t.data.some(i=>i.stock_code===a):!1,[t.data]),p=c.useCallback(a=>t.data&&t.data.find(i=>i.stock_code===a)||null,[t.data]),m=c.useCallback(a=>n.get(a)||{isAdding:!1,isRemoving:!1,hasError:!1},[n]),g=c.useCallback(a=>{s(i=>{const o=new Map(i),u=o.get(a);return u&&o.set(a,{...u,hasError:!1}),o})},[]),R=c.useCallback(()=>{const a=t.data||[],i=a.length,o=a.filter(f=>f.alert_price!==null).length,u=a.filter(f=>f.notes&&f.notes.trim().length>0).length;return{totalItems:i,itemsWithAlerts:o,itemsWithNotes:u}},[t.data]),M=c.useCallback(()=>{l()},[l]);return{...t,items:t.data||[],fetch:l,refresh:M,addToWatchlist:h,removeFromWatchlist:y,isInWatchlist:v,getWatchlistItem:p,getItemState:m,clearItemError:g,getWatchlistStats:R,isLoading:t.status==="loading",isError:t.status==="error",isSuccess:t.status==="success",isEmpty:t.data?.length===0}}function ee(e){const t=A(),r=t.getWatchlistItem(e),n=t.getItemState(e),s=t.isInWatchlist(e),l=c.useCallback(async(v,p,m)=>{const g={stock_code:e,alert_price_high:v||null,alert_price_low:p||null,notes:m||null};return t.addToWatchlist(g)},[e,t]),h=c.useCallback(async()=>t.removeFromWatchlist(e),[e,t]),y=c.useCallback(async(v,p,m)=>s?h():l(v,p,m),[s,l,h]);return{item:r,isInWatchlist:s,isAdding:n.isAdding,isRemoving:n.isRemoving,hasError:n.hasError,addToWatchlist:l,removeFromWatchlist:h,toggleWatchlist:y,clearError:()=>t.clearItemError(e)}}const j={error:{bgColor:"bg-red-50",borderColor:"border-red-200",textColor:"text-red-800",iconColor:"text-red-400",buttonColor:"bg-red-600 hover:bg-red-700",icon:"❌"},warning:{bgColor:"bg-yellow-50",borderColor:"border-yellow-200",textColor:"text-yellow-800",iconColor:"text-yellow-400",buttonColor:"bg-yellow-600 hover:bg-yellow-700",icon:"⚠️"},info:{bgColor:"bg-blue-50",borderColor:"border-blue-200",textColor:"text-blue-800",iconColor:"text-blue-400",buttonColor:"bg-blue-600 hover:bg-blue-700",icon:"ℹ️"}},V={sm:{padding:"p-3",textSize:"text-sm",buttonSize:"px-3 py-1 text-sm"},md:{padding:"p-4",textSize:"text-base",buttonSize:"px-4 py-2 text-sm"},lg:{padding:"p-6",textSize:"text-lg",buttonSize:"px-6 py-3 text-base"}};function S(e){return e?typeof e=="string"?e:e instanceof Error?e.message:"不明なエラーが発生しました":""}function q({error:e,type:t="error",size:r="md",showIcon:n=!0,onRetry:s,onDismiss:l,retryText:h="再試行",dismissText:y="閉じる",className:v=""}){const p=S(e);if(!p)return null;const m=j[t],g=V[r];return d.jsx("div",{className:`
      ${m.bgColor} 
      ${m.borderColor} 
      ${m.textColor}
      border rounded-lg
      ${g.padding}
      ${v}
    `,children:d.jsxs("div",{className:"flex items-start space-x-3",children:[n&&d.jsx("span",{className:`${g.textSize} flex-shrink-0`,role:"img","aria-label":t,children:m.icon}),d.jsx("div",{className:"flex-1 min-w-0",children:d.jsx("p",{className:`${g.textSize} font-medium`,children:p})}),(s||l)&&d.jsxs("div",{className:"flex-shrink-0 flex space-x-2",children:[s&&d.jsx("button",{onClick:s,className:`
                  ${m.buttonColor}
                  ${g.buttonSize}
                  text-white
                  rounded
                  font-medium
                  transition-colors
                  focus:outline-none
                  focus:ring-2
                  focus:ring-offset-2
                  focus:ring-opacity-50
                `,children:h}),l&&d.jsx("button",{onClick:l,className:`
                  ${g.buttonSize}
                  ${m.textColor}
                  border
                  ${m.borderColor}
                  rounded
                  font-medium
                  transition-colors
                  hover:bg-opacity-50
                  focus:outline-none
                  focus:ring-2
                  focus:ring-offset-2
                  focus:ring-opacity-50
                `,children:y})]})]})})}function D({error:e,className:t=""}){const r=S(e);return r?d.jsx("p",{className:`text-red-600 text-sm font-medium ${t}`,children:r}):null}function P({title:e="データがありません",description:t="",icon:r="📭",action:n,actionText:s="データを取得",className:l=""}){return d.jsxs("div",{className:`text-center py-12 ${l}`,children:[d.jsx("div",{className:"text-6xl mb-4",role:"img","aria-label":"空の状態",children:r}),d.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:e}),t&&d.jsx("p",{className:"text-gray-600 mb-6",children:t}),n&&d.jsx("button",{onClick:n,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:s})]})}q.__docgenInfo={description:"",methods:[],displayName:"ErrorMessage",props:{error:{required:!0,tsType:{name:"union",raw:"string | Error | null",elements:[{name:"string"},{name:"Error"},{name:"null"}]},description:""},type:{required:!1,tsType:{name:"union",raw:"'error' | 'warning' | 'info'",elements:[{name:"literal",value:"'error'"},{name:"literal",value:"'warning'"},{name:"literal",value:"'info'"}]},description:"",defaultValue:{value:"'error'",computed:!1}},size:{required:!1,tsType:{name:"union",raw:"'sm' | 'md' | 'lg'",elements:[{name:"literal",value:"'sm'"},{name:"literal",value:"'md'"},{name:"literal",value:"'lg'"}]},description:"",defaultValue:{value:"'md'",computed:!1}},showIcon:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},onRetry:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onDismiss:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},retryText:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'再試行'",computed:!1}},dismissText:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'閉じる'",computed:!1}},className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"''",computed:!1}}}};D.__docgenInfo={description:"Inline Error Message (for forms, etc.)",methods:[],displayName:"InlineErrorMessage",props:{error:{required:!0,tsType:{name:"union",raw:"string | Error | null",elements:[{name:"string"},{name:"Error"},{name:"null"}]},description:""},className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"''",computed:!1}}}};P.__docgenInfo={description:"Empty State Message",methods:[],displayName:"EmptyStateMessage",props:{title:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'データがありません'",computed:!1}},description:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"''",computed:!1}},icon:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'📭'",computed:!1}},action:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},actionText:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'データを取得'",computed:!1}},className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"''",computed:!1}}}};export{q as E,D as I,H as a,G as b,K as c,Y as d,X as e,J as f,$ as g,A as h,P as i,B as j,Z as s,ee as u,Q as v};
